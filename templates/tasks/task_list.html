{% extends 'base.html' %}
{% load static %}
{% load task_extras %}

{% block title %}{{ view_type }} - {{ app_name }}{% endblock %}

{% block page_title %}
<h2>{{ view_type }}</h2>
<p class="view-description">This page demonstrates Django's function-based views with template rendering and context data.</p>
{% endblock %}

{% block content %}
<!-- Add New Task Form -->
<div class="add-task-container">
    <h3>Add New Task</h3>
    <form method="post" class="add-task-form">
        {% csrf_token %}
        <div class="form-group">
            {{ form.title }}
            {% if form.title.errors %}
                <div class="error-messages">
                    {% for error in form.title.errors %}
                        <span class="error">{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <button type="submit" class="btn btn-primary">Add Task</button>
    </form>
</div>

<!-- Task Statistics -->
<div class="stats-container">
    <h3>Task Statistics</h3>
    <div class="stats-grid">
        <div class="stat-item">
            <span class="stat-number">{{ total_tasks }}</span>
            <span class="stat-label">Total Tasks</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ completed_tasks }}</span>
            <span class="stat-label">Completed</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ pending_tasks }}</span>
            <span class="stat-label">Pending</span>
        </div>
    </div>
</div>

<!-- Task List -->
<div class="task-container">
    <h3>All Tasks</h3>
    
    {% if tasks %}
        <div class="task-list">
            {% for task in tasks %}
                <div class="task-item {% if task.completed %}completed{% else %}pending{% endif %}">
                    <div class="task-content">
                        <div class="task-header">
                            <span class="task-status">
                                {% if task.completed %}
                                    ✅ Completed
                                {% else %}
                                    ❌ Pending
                                {% endif %}
                            </span>
                            <div class="task-actions">
                                <form method="post" action="{% url 'tasks:toggle_task' task.id %}" class="inline-form">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-toggle">
                                        {% if task.completed %}Mark Pending{% else %}Mark Complete{% endif %}
                                    </button>
                                </form>
                                <a href="{% url 'tasks:edit_task' task.id %}" class="btn btn-sm btn-edit">Edit</a>
                                <form method="post" action="{% url 'tasks:delete_task' task.id %}" class="inline-form" 
                                      onsubmit="return confirm('Are you sure you want to delete this task?')">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-delete">Delete</button>
                                </form>
                            </div>
                        </div>
                        <h4 class="task-title">
                            {% if task.title|length > 50 %}
                                {{ task.title|truncatechars:50|highlight }}
                            {% else %}
                                {{ task.title|highlight }}
                            {% endif %}
                        </h4>
                        <p class="task-meta">
                            Created: {{ task.created_at|date:"M d, Y H:i" }}
                            | Status: {{ task.completed|yesno:"Completed,Pending" }}
                        </p>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-tasks">
            <p>No tasks available. Create some tasks in the Django admin!</p>
        </div>
    {% endif %}
</div>

<!-- Template Features Demo -->
<div class="features-demo">
    <h3>Template Features Demonstrated</h3>
    <ul>
        <li><strong>Template Inheritance:</strong> This template extends base.html</li>
        <li><strong>Template Tags:</strong> Using {% templatetag openblock %} for for loops</li>
        <li><strong>Template Filters:</strong> 
            <ul>
                <li><code>|upper</code>: {{ "hello world"|upper }}</li>
                <li><code>|truncatechars:50</code>: Truncates long text</li>
                <li><code>|date:"M d, Y H:i"</code>: Formats dates</li>
                <li><code>|yesno:"Completed,Pending"</code>: Boolean to text</li>
                <li><strong>Custom Filter:</strong> <code>|highlight</code>: {{ "Important text"|highlight }}</li>
            </ul>
        </li>
        <li><strong>Context Data:</strong> View passes statistics and task data</li>
        <li><strong>Static Files:</strong> CSS loaded via {% templatetag openblock %} load static {% templatetag closeblock %}</li>
    </ul>
</div>
{% endblock %}
