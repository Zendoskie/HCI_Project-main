{% extends 'base.html' %}
{% load static %}
{% load task_extras %}

{% block title %}{{ view_type }} - {{ app_name }}{% endblock %}

{% block page_title %}
<h2>{{ view_type }}</h2>
<p class="view-description">This page demonstrates Django's class-based views using ListView with automatic template rendering and context enhancement.</p>
{% endblock %}

{% block content %}
<!-- Add New Task Form -->
<div class="add-task-container">
    <h3>Add New Task</h3>
    <form method="post" class="add-task-form">
        {% csrf_token %}
        <div class="form-group">
            {{ form.title }}
            {% if form.title.errors %}
                <div class="error-messages">
                    {% for error in form.title.errors %}
                        <span class="error">{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <button type="submit" class="btn btn-primary">Add Task</button>
    </form>
</div>

<!-- Task Statistics -->
<div class="stats-container">
    <h3>Task Statistics</h3>
    <div class="stats-grid">
        <div class="stat-item">
            <span class="stat-number">{{ total_tasks }}</span>
            <span class="stat-label">Total Tasks</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ completed_tasks }}</span>
            <span class="stat-label">Completed</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ pending_tasks }}</span>
            <span class="stat-label">Pending</span>
        </div>
    </div>
</div>

<!-- Task List -->
<div class="task-container">
    <h3>All Tasks (Class-Based View)</h3>
    
    {% if tasks %}
        <div class="task-list">
            {% for task in tasks %}
                <div class="task-item {% if task.completed %}completed{% else %}pending{% endif %}">
                    <div class="task-content">
                        <div class="task-header">
                            <span class="task-status">
                                {% if task.completed %}
                                    ✅ Completed
                                {% else %}
                                    ❌ Pending
                                {% endif %}
                            </span>
                            <div class="task-actions">
                                <form method="post" action="{% url 'tasks:toggle_task' task.id %}" class="inline-form">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-toggle">
                                        {% if task.completed %}Mark Pending{% else %}Mark Complete{% endif %}
                                    </button>
                                </form>
                                <a href="{% url 'tasks:edit_task' task.id %}" class="btn btn-sm btn-edit">Edit</a>
                                <a href="{% url 'tasks:delete_task_cbv' task.id %}" class="btn btn-sm btn-delete" 
                                   onclick="return confirm('Are you sure you want to delete this task?')">Delete</a>
                            </div>
                        </div>
                        <h4 class="task-title">
                            {% if task.title|length > 50 %}
                                {{ task.title|truncatechars:50|highlight }}
                            {% else %}
                                {{ task.title|highlight }}
                            {% endif %}
                        </h4>
                        <p class="task-meta">
                            Created: {{ task.created_at|date:"M d, Y H:i" }}
                            | Status: {{ task.completed|yesno:"Completed,Pending" }}
                        </p>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-tasks">
            <p>No tasks available. Create some tasks in the Django admin!</p>
        </div>
    {% endif %}
</div>

<!-- Class-Based View Features Demo -->
<div class="features-demo">
    <h3>Class-Based View Features Demonstrated</h3>
    <ul>
        <li><strong>ListView:</strong> Automatic model querying and template rendering</li>
        <li><strong>get_context_data():</strong> Enhanced context with statistics</li>
        <li><strong>context_object_name:</strong> Tasks available as 'tasks' in template</li>
        <li><strong>template_name:</strong> Explicit template specification</li>
        <li><strong>model:</strong> Automatic queryset from Task model</li>
        <li><strong>Template Inheritance:</strong> Same base template, different content</li>
        <li><strong>Custom Filters:</strong> Same highlighting and formatting filters</li>
    </ul>
</div>

<!-- Comparison -->
<div class="comparison">
    <h3>Function-Based vs Class-Based Views</h3>
    <div class="comparison-grid">
        <div class="comparison-item">
            <h4>Function-Based Views</h4>
            <ul>
                <li>Simple and straightforward</li>
                <li>Full control over logic</li>
                <li>Easy to understand for beginners</li>
                <li>Manual context creation</li>
            </ul>
        </div>
        <div class="comparison-item">
            <h4>Class-Based Views</h4>
            <ul>
                <li>Reusable and extensible</li>
                <li>Built-in functionality (ListView, DetailView, etc.)</li>
                <li>Better for complex operations</li>
                <li>Automatic context handling</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
